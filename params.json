{"name":"Colbert","tagline":"Manage your small-business accounting","body":"Colbert\r\n=======\r\n\r\n*Colbert* is not about [Stephen\r\nColbert](http://www.colbertnation.com/the-colbert-report-videos/430767/november-21-2013/intro---11-21-13).\r\nIt is serious matter.\r\n\r\nThe name is a tribute to [Jean-Baptiste\r\nColbert](http://en.wikipedia.org/wiki/Jean-Baptiste_Colbert), the\r\nMinister of Finances of France in the 17th century also known for being\r\nthe father of the modern accountancy.\r\n\r\nFunctionalities\r\n---------------\r\n\r\nColbert helps you to manage your accountancy with a unique constraint:\r\nget your *Livre Journal* (the book where you are supposed to daily\r\nregister the financial operations) up-to-date. That's it.\r\n\r\nFrom that file it produce the annual reports (*Bilan*, *Compte de\r\nrésultat* etc). There are also some utilities to check your\r\nLivre-journal against the bank reports, to generate invoices, activity\r\nreport from *iCalendar* etc.\r\n\r\nDisclaimer(s)\r\n-------------\r\n\r\nThis software has **not** been written by and /or with the help of an\r\naccountant (and no accountant has been hurt during the process).\r\n\r\nThe concepts\r\n------------\r\n\r\n### Background\r\n\r\nI am running a small business since 2011 and from the start I decided to\r\nnot outsource the accountancy nor to use a commercial software.\r\n\r\nMaybe I should have given [Gnucash](http://www.gnucash.org/) but I\r\ndecided to be cheap on the technology side and to build a collection of\r\nutilities on the fly as I was facing formalities.\r\n\r\n*Colbert* is that very collection of tools working over organized and\r\nformated text files (*reStructuredText* and *JSON*). These tools produce\r\nother text files. Combined with LaTex (inside Makefile for automation)\r\nyou can produce beautiful documents.\r\n\r\n:\r\n\r\n    colbert-scripts\r\n\r\n> file-A.txt, -----------------\\> file-C.txt file-B.json - - | | | |\r\n> LaTex, etc. | LaTeX, etc. | | v v file-A.tex file-C.tex file-A.pdf\r\n> file-A.ps\r\n\r\nThe core of accountancy is *le livre-journal*. This is our database\r\nwhere every single operation occuring in your business is recorded. Each\r\noperation must be balanced: the sum of the entries must be balanced by\r\none or more output of the same amount.\r\n\r\nIn large compagnies, this book is usualy splitted in several ones to\r\nregroup operations by type.\r\n\r\nThe scaffold I use is the following:\r\n\r\n    + MyBusiness/   +-- accountancy/    +-- livre-journal/  +-- livre-journal.txt \r\n                                        |                   | \r\n                                        |                   +-- Makefile \r\n                                        |\r\n                                        +-- 2011/   +-- grand-livre/\r\n                                        |           |\r\n                                        |           +-- releves-bancaires/  \r\n                                        |           |\r\n                                        |           +-- factures/           \r\n                                        |           |\r\n                                        |           +-- balance-des-comptes/\r\n                                        |           |\r\n                                        |           +-- bilan/\r\n                                        |           |\r\n                                        |           +-- compte-de-resultat/ \r\n                                        |           |\r\n                                        |           +-- TVA/                \r\n                                        |           |\r\n                                        |           +-- ecritures-de-cloture/\r\n                                        |\r\n                                        +-- 2012/   +-- grand-livre/\r\n                                        |           |\r\n                                        |           +-- releves-bancaires/  \r\n                                                    ...\r\n\r\n*Le livre-journal* is a never-ending story, this is the reason for\r\nkeeping it at the root level. In accountancy, a main concept is\r\n*l'indépendance des exercices comptables* which is why I have broken\r\ndown my organization by year (I am opening my accounts on Junary the 1st\r\nand closing them on December, 31th, every year).\r\n\r\nIn each year directory reside sub-directories named with the tasks,\r\nbooks or documents you have to deal with and produce all along the\r\nfinancial/fiscal year.\r\n\r\nAlmost every sub-directory should contain a Makefile to automatically\r\ncall some Colbert or LaTeX routines to update your files from the source\r\n(which may be the *livre-journal*, the *Grand-livre* or the *Balance des\r\ncomptes*).\r\n\r\nIn a nutshell, a typical usage at the end of a fiscal year is:\r\n\r\n1.  having a *Livre-journal* up-to-date and accurate ;\r\n2.  check your *relevés bancaires* (bank statement) against the\r\n    Livre-journal. Go back to (1) if it is not the case ;\r\n3.  generate the *Grand-livre* as JSON from the Livre-journal ;\r\n4.  generate the *Balance des comptes* from the *grand\\_livre.json* file\r\n    ;\r\n5.  compute the *Bilan* from the *balance\\_des\\_comptes.json* file ;\r\n6.  compute the *Compte de résultat* from the\r\n    *balance\\_des\\_comptes.json* file ;\r\n7.  compute the *écritures de clôture* from the\r\n    *balance\\_des\\_comptes.json* file and write them back to the\r\n    Livre-journal ;\r\n\r\n**Note** : each *JSON* file can be converted in a *reStructuredText*\r\nformat with a *colbert\\_\\*\\_to\\_rst* script.\r\n\r\n### Le Livre-journal\r\n\r\nThe Livre-journal is a diary or a book where every flow of money is\r\nlogged. There is a tight legislation concerning those books in general\r\nand you must refer yourself to the legislation of your country or\r\njuridiction.\r\n\r\nIn Colbert, this is a reStructuredText file meeting the french\r\nadministration requirements (the columns' width had been reduced to fit\r\nproperly in this document):\r\n\r\n``` {.sourceCode .rst}\r\n==================\r\nMyBusiness S.A.R.L\r\n==================\r\n\r\n-------------\r\nLivre-Journal\r\n-------------\r\n\r\n+-------------+-----------------+-----------------+-------------------------------------------------+-----------+-----------+\r\n| Date        |  N°compte débit | N°compte crédit |   Intitulé / nom du compte                      | Débit en €| Crédit en |\r\n+=============+=================+=================+=================================================+===========+===========+\r\n| *Mars 2011*                                                                                                               |\r\n+-------------+-----------------+-----------------+-------------------------------------------------+-----------+-----------+\r\n|| 18/03/2011 ||                ||                || Frais de constitution de la société CFE Paris. ||          ||          |\r\n||            ||    6227        ||                || Achats - Frais d'actes et de contentieux       ||  80.00   ||          |\r\n||            ||    44566       ||                || T.V.A. déductible sur autres biens et services ||  10.45   ||          |\r\n||            ||                ||     455        ||     Associés - Comptes courants                ||          ||    90.45 |\r\n+-------------+-----------------+-----------------+-------------------------------------------------+-----------+-----------+\r\n|| 18/03/2011 ||                ||                || Frais de constitution de la société - Annonce  ||          ||          |\r\n||            ||    6227        ||                || Achats - Frais d'actes et de contentieux       ||  80.00   ||          |\r\n||            ||    44566       ||                || T.V.A. déductible sur autres biens et services ||  19.00   ||          |\r\n||            ||                ||     455        ||     Associés - Comptes courants                ||          ||    99.00 |\r\n+-------------+-----------------+-----------------+-------------------------------------------------+-----------+-----------+\r\n|| 31/03/2011 ||                ||                || Facture 2011-01 MyClient1                      ||          ||          |\r\n||            ||                ||                ||       Prestation MyClient1 mars 2011           ||          ||          |\r\n||            ||    4111-CL1    ||                ||     Clients - ventes de biens ou prestations   ||  980.00  ||          |\r\n||            ||                ||    706         ||      Produits - prestations de services        ||          ||  5 000.00|\r\n||            ||                ||    44587       ||      Taxes sur le CA sur factures à établir    ||          ||  980.00  |\r\n+-------------+-----------------+-----------------+-------------------------------------------------+-----------+-----------+\r\n| *Avril 2011*                                                                                                              |\r\n+-------------+-----------------+-----------------+-------------------------------------------------+-----------+-----------+\r\n|| 01/04/2011 ||                ||                || Résultat arrêté compte                         ||          ||          |\r\n||            ||    6278-LCL    ||                || Autres frais de commission sur prestations     ||  48.00   ||          |\r\n||            ||                ||     512        ||     Banques                                    ||          ||   48.00  |\r\n+-------------+-----------------+-----------------+-------------------------------------------------+-----------+-----------+\r\n```\r\n\r\nEach entry is a multiline row in the table.\r\n\r\nI use *Line Blocks* to get a descent formatting in the multiline cells.\r\nTrying to right-align the content of the two last columns was a failure.\r\nIn fact for a reason I don't get, if those values are not left-aligned,\r\nthe LaTeX conversion sucks.\r\n\r\nThe optional *thousand separator* cannot be anything else than a space\r\ncharacter at the moment. This is on the TODO list.\r\n\r\n#### Checking the Livre-journal\r\n\r\nA first script allows you to check the entries balance of the book:\r\n\r\n``` {.sourceCode .bash}\r\n$ colbert_check_livre_journal.py my_livre_journal.txt\r\n```\r\n\r\nMy Makefile in the Livre-journal directory being:\r\n\r\n``` {.sourceCode .make}\r\nFILENAME=\"livre-journal\"\r\n\r\nall:    pdf\r\n\r\npdf:    tex\r\n    @pdflatex $(FILENAME).tex\r\n    @pdflatex $(FILENAME).tex\r\n    @colbert_check_livre_journal.py $(FILENAME).txt\r\n\r\ntex:\r\n    @rst2latex.py $(FILENAME).txt > $(FILENAME).tex\r\n\r\npurge:  clean\r\n    @for ext in \".pdf\" \".tex\" \".txt\"; do\\\r\n        [ -e $(FILENAME)$${ext} ] && rm $(FILENAME)$${ext} || [ 1 ] ;\\\r\n    done\r\n\r\nclean:\r\n    @for ext in \".out\" \".aux\" \".log\" \".tex.tmp\"; do\\\r\n        [ -e $(FILENAME)$${ext} ] && rm $(FILENAME)$${ext} || [ 1 ] ;\\\r\n    done\r\n```\r\n\r\n#### Computing VAT\r\n\r\nThe *colbert\\_solder\\_tva.py* script compute the flow of money on the\r\nVAT-related accounts for a period of time and produce an JSON-entry to\r\ncounter-balance these entries. Then you (manually) copy/paste this entry\r\nin the Livre-journal. Obviously, the JSON-entry need to be converted\r\nfirst in the reStructuredText format of the Livre-journal with the\r\n*colbert\\_ecritures\\_to\\_livre\\_journal.py* utility.\r\n\r\nThis is something you have to do every month or every quarter in France.\r\n\r\nIn the *TVA* directory:\r\n\r\n``` {.sourceCode .bash}\r\n$ colbert_solder_tva ../../livre-journal/livre-journal.txt -d 01/03/2011 -f 30/9/2011 > solde-tva-sept-2011.json\r\n$ colbert_ecritures_to_livre_journal solde-tva-sept-2011.json > solde-tva-sept-2011.txt\r\n```\r\n\r\n### Le Grand-livre\r\n\r\nIn that book are gathered the entries of the Livre-journal by account\r\nnumber for a period of time (a fiscal year). One table for every single\r\naccount.\r\n\r\nEvery account should start with the *report à nouveau* (the balance) of\r\nthe previous fiscal year.\r\n\r\nTo generate the Grand-livre, run the following:\r\n\r\n``` {.sourceCode .bash}\r\n$ @colbert_grand_livre.py ../../livre-journal/livre-journal.txt --label=\"MyBusiness - Grand-Livre 2011\" -d 1/1/2011 -f 31/12/2011 > grand-livre_2011.json\r\n```\r\n\r\nAnd then in reStructuredText:\r\n\r\n``` {.sourceCode .bash}\r\n$ colbert_grand_livre_to_rst.py grand-livre_2011.json > grand-livre_2011.txt\r\n```\r\n\r\nOr in a Makefile:\r\n\r\n``` {.sourceCode .make}\r\nFILENAME=\"grand_livre-2011\"\r\nDATE_DEBUT=\"18/03/2011\"\r\nDATE_FIN=\"31/12/2011\"\r\n\r\nall:    pdf\r\n\r\npdf:    tex\r\n    @pdflatex $(FILENAME).tex\r\n    @pdflatex $(FILENAME).tex\r\n    @pdflatex $(FILENAME).tex\r\n\r\ntex:    rst\r\n    @rst2latex.py --table-style=booktabs $(FILENAME).txt >  $(FILENAME).tex.tmp\r\n    @sed -E -f fix_table.sed < $(FILENAME).tex.tmp > $(FILENAME).tex\r\n\r\nrst:    json\r\n    @echo \"Conversion du grand livre au format reStructuredText...\"\r\n    @colbert_grand_livre_to_rst.py $(FILENAME).json > $(FILENAME).txt\r\n\r\njson:\r\n    @echo \"calcul du Grand-Livre...\"\r\n    @colbert_grand_livre.py ../../livre-journal/livre-journal.txt --label=\"MyBusiness - Grand-Livre 2011\" -d $(DATE_DEBUT) -f $(DATE_FIN) > $(FILENAME).json\r\n\r\npurge:  clean\r\n    @for ext in \".pdf\" \".tex\" \".txt\"; do\\\r\n        [ -e $(FILENAME)$${ext} ] && rm $(FILENAME)$${ext} || [ 1 ] ;\\\r\n    done\r\n\r\nclean:\r\n    @for ext in \".out\" \".aux\" \".log\" \".tex.tmp\"; do\\\r\n        [ -e $(FILENAME)$${ext} ] && rm $(FILENAME)$${ext} || [ 1 ] ;\\\r\n    done\r\n```\r\n\r\nThe *fix\\_table.sed* in the TeX conversion rule is a Sed script managing\r\nthe right-alignment of the money columns:\r\n\r\n    s/\\\\begin{longtable\\*}.*/\\\\newcolumntype{x}[1]{% \\\r\n    >{\\\\raggedleft\\\\hspace{0pt}}p{#1}}% \\\r\n    \\\\newcolumntype{y}[1]{% \\\r\n    >{\\\\raggedright\\\\hspace{0pt}}p{#1}}% \\\r\n    \\\\begin{longtable*}[c]{y{2cm}y{7.5cm}x{2cm}|y{2cm}y{7.5cm}x{2cm}}/\r\n    s/&[[:space:]]+\\\\\\\\/\\& \\\\tabularnewline/\r\n    s/[[:space:]]+\\\\\\\\$/\\\\tabularnewline/\r\n\r\nHere an example of the reStructuredText output:\r\n\r\n``` {.sourceCode .rst}\r\n================\r\nGrand-Livre 2011\r\n================\r\n\r\n\r\n-----------------------------------\r\nPériode du 01/03/2011 au 31/12/2011\r\n-----------------------------------\r\n\r\n\r\n\r\n100 - *Capital et compte de l'exploitant*\r\n'''''''''''''''''''''''''''''''''''''''''\r\n\r\n\r\n+------------+---------------------------------+-------------+------------+---------------------------------------+---------+\r\n| Date       | Libellé                         | Débit       | Date       | Libellé                               | Crédit  |\r\n+============+=================================+=============+============+=======================================+=========+\r\n|            |                                 |             | 02/04/2011 | Capital initial Dépôt de 1500 € par...| 1500.00 |\r\n+------------+---------------------------------+-------------+------------+---------------------------------------+---------+\r\n|            | *Solde créditeur au 31/12/2011* | **1500.00** |            |                                       |         |\r\n+------------+---------------------------------+-------------+------------+---------------------------------------+---------+\r\n\r\n.. raw:: latex\r\n\r\n    \\newpage\r\n\r\n\r\n4111-CL1 - *Clients - ventes de biens ou prestations de services*\r\n'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''\r\n\r\n\r\n+------------+---------------------------------+----------+------------+-----------------------------------------+----------+\r\n| Date       | Libellé                         | Débit    | Date       | Libellé                                 | Crédit   |\r\n+============+=================================+==========+============+=========================================+==========+\r\n| 31/03/2011 | Facture 2011-01 MyClient1 ...   | 5980.00  | 02/09/2011 | Virement MyClient1 ZZZZZZZZZZZ Facture..| 5980.00  |\r\n+------------+---------------------------------+----------+------------+-----------------------------------------+----------+\r\n| 28/09/2011 | Facture 2011-04 MyClient1 ...   | 13156.00 | 01/12/2011 | Virement MyClient1 WWWWWWWWWW Facture...| 18538.00 |\r\n+------------+---------------------------------+----------+------------+-----------------------------------------+----------+\r\n| 01/11/2011 | Facture 2011-05 MyClient1 ...   | 5382.00  |            |                                         |          |\r\n+------------+---------------------------------+----------+------------+-----------------------------------------+----------+\r\n|            | *Compte soldé au 31/12/2011.*   |          |            | *Compte soldé au 31/12/2011.*           |          |\r\n+------------+---------------------------------+----------+------------+-----------------------------------------+----------+\r\n\r\n.. raw:: latex\r\n```\r\n\r\n#### N+1 years\r\n\r\nWhen you start a new year there are two things to keep in mind for the\r\nGrand-Livre:\r\n\r\n-   to start with the *Report à nouveau* of the account of the previous\r\n    year ;\r\n-   to include the entries of the previous year that have not been\r\n    included in the Grand-Livre.\r\n\r\n*Colbert* does it for you. All you have to do is to provide the path of\r\nthe previous one (as JSON):\r\n\r\n``` {.sourceCode .bash}\r\n$ @colbert_grand_livre.py ../../livre-journal/livre-journal.txt --label=\"MyBusiness - Grand-Livre 2012\" \\\r\n    -d 1/1/2012 -f 31/12/2012 -p ../../2011/grand-livre/grand-livre_2011.json > grand-livre_2012.json\r\n```\r\n\r\n### La balance des comptes\r\n\r\nThe next financial piece is a single table regrouping the balance of the\r\naccounts. It is computed from the Grand-livre for the sake of\r\nsimplicity.\r\n\r\nAgain, you first generate a JSON file and then a reStructuredText file:\r\n\r\n``` {.sourceCode .bash}\r\n$ colbert_balance_des_comptes.py ../grand-livre/grand_livre-2011.json \\\r\n    --label=\"MyBusiness - Balance des comptes 2011 en €\"  > $balance-des-comptes.json\r\n$ colbert_balance_des_comptes_to_rst.py balance-des-comptes.json > balance-des-comptes.txt\r\n```\r\n\r\nAnd again, you should use this Makefile:\r\n\r\n``` {.sourceCode .make}\r\nFILENAME=\"balance_des_comptes-2011\"\r\n\r\nall:    pdf\r\n\r\npdf:    tex\r\n    @pdflatex $(FILENAME).tex\r\n    @pdflatex $(FILENAME).tex\r\n    @pdflatex $(FILENAME).tex\r\n\r\ntex:    rst\r\n    @rst2latex.py --table-style=booktabs $(FILENAME).txt >  $(FILENAME).tex.tmp\r\n    @sed -E -f fix_table.sed < $(FILENAME).tex.tmp > $(FILENAME).tex\r\n\r\nrst:    json\r\n    @echo \"Conversion de la balance des comptes au format reStructuredText...\"\r\n    @colbert_balance_des_comptes_to_rst.py $(FILENAME).json > $(FILENAME).txt\r\n\r\njson:\r\n    @echo \"calcul de la balance des comptes...\"\r\n    @colbert_balance_des_comptes.py ../grand-livre/grand_livre-2011.json --label=\"MyBusiness - Balance des comptes 2011 en €\"  > $(FILENAME).json\r\n\r\npurge:  clean\r\n    @for ext in \".pdf\" \".tex\" \".txt\"; do\\\r\n        [ -e $(FILENAME)$${ext} ] && rm $(FILENAME)$${ext} || [ 1 ] ;\\\r\n    done\r\n\r\nclean:\r\n    @for ext in \".out\" \".aux\" \".log\" \".tex.tmp\"; do\\\r\n        [ -e $(FILENAME)$${ext} ] && rm $(FILENAME)$${ext} || [ 1 ] ;\\\r\n    done\r\n```\r\n\r\nWith the Sed fix:\r\n\r\n    s/\\\\begin{longtable\\*}.*/\\\\newcolumntype{x}[1]{% \\\r\n    >{\\\\raggedleft\\\\hspace{0pt}}p{#1}}% \\\r\n    \\\\newcolumntype{y}[1]{% \\\r\n    >{\\\\raggedright\\\\hspace{0pt}}p{#1}}% \\\r\n    \\\\begin{longtable*}[c]{y{2cm}y{8.5cm}x{2.2cm}x{2.2cm}x{2.2cm}x{2.2cm}}/\r\n    s/} \\\\\\\\/} \\\\tabularnewline/\r\n    s/&[[:space:]]+\\\\\\\\/\\& \\\\tabularnewline/\r\n    s/[[:space:]]+\\\\\\\\$/\\\\tabularnewline/\r\n\r\nAnd here a example of the reStructuredText output (again, the table\r\nwidth had been reduced here to fit well):\r\n\r\n``` {.sourceCode .rst}\r\n=====================================\r\nBalance des comptes 2011 - MyBusiness\r\n=====================================\r\n\r\n\r\n-----------------------------------\r\nPériode du 01/03/2011 au 31/12/2011\r\n-----------------------------------\r\n\r\n\r\n+--------------+---------------------------------------------------+-------------+--------------+-------------+-------------+\r\n| N°           | Libellé                                           | Total débit | Total crédit | Solde débit | Solde crédit|\r\n+==============+===================================================+=============+==============+=============+=============+\r\n| 100          | Capital et compte de l'exploitant                 |             | 1500.00      |             | 1500.00     |\r\n+--------------+---------------------------------------------------+-------------+--------------+-------------+-------------+\r\n| 4111-CL1     | Clients - ventes de biens ou prestations de ser...| 24518.00    | 24518.00     |             |             |\r\n+--------------+---------------------------------------------------+-------------+--------------+-------------+-------------+\r\n| 4111-CL2     | Clients - ventes de biens ou prestations de ser...| 1794.00     | 1794.00      |             |             |\r\n+--------------+---------------------------------------------------+-------------+--------------+-------------+-------------+\r\n| 4111-CL3     | Clients - ventes de biens ou prestations de ser...| 8372.00     |              | 8372.00     |             |\r\n+--------------+---------------------------------------------------+-------------+--------------+-------------+-------------+\r\n| 4181         | Clients - Factures à établir                      | 13156.00    |              | 13156.00    |             |\r\n+--------------+---------------------------------------------------+-------------+--------------+-------------+-------------+\r\n| 44551        | TVA à décaisser                                   | 1240.00     | 4278.00      |             | 3038.00     |\r\n+--------------+---------------------------------------------------+-------------+--------------+-------------+-------------+\r\n| 44566        | T.V.A. déductible sur autres biens et services    | 33.66       | 33.66        |             |             |\r\n+--------------+---------------------------------------------------+-------------+--------------+-------------+-------------+\r\n| 44571        | T.V.A. Collectée                                  | 4312.00     | 4312.00      |             |             |\r\n+--------------+---------------------------------------------------+-------------+--------------+-------------+-------------+\r\n| 44587        | Taxes sur le CA sur factures à établir            | 4312.00     | 7840.00      |             | 3528.00     |\r\n+--------------+---------------------------------------------------+-------------+--------------+-------------+-------------+\r\n| 455          | Associés - Comptes courants                       |             | 189.45       |             | 189.45      |\r\n+--------------+---------------------------------------------------+-------------+--------------+-------------+-------------+\r\n| 512          | Banques                                           | 27812.00    | 5132.65      | 22679.35    |             |\r\n+--------------+---------------------------------------------------+-------------+--------------+-------------+-------------+\r\n| 60225        | Achats - Fournitures de bureau                    | 21.44       |              | 21.44       |             |\r\n+--------------+---------------------------------------------------+-------------+--------------+-------------+-------------+\r\n| 6227         | Achats - Frais d'actes et de contentieux          | 160.00      |              | 160.00      |             |\r\n+--------------+---------------------------------------------------+-------------+--------------+-------------+-------------+\r\n| 6278-LCL     | Autres frais de commission sur prestations de s...| 72.00       |              | 72.00       |             |\r\n+--------------+---------------------------------------------------+-------------+--------------+-------------+-------------+\r\n| 6411         | Charges - Salaires et appointements               | 3000.00     |              | 3000.00     |             |\r\n+--------------+---------------------------------------------------+-------------+--------------+-------------+-------------+\r\n| 6411-RSI     | Charges - cotisations RSI                         | 393.00      |              | 393.00      |             |\r\n+--------------+---------------------------------------------------+-------------+--------------+-------------+-------------+\r\n| 6411-URSF1   | Charges - cotisations URSSAF - Allocations famil..| 161.80      |              | 161.80      |             |\r\n+--------------+---------------------------------------------------+-------------+--------------+-------------+-------------+\r\n| 6411-URSF2   | Charges - cotisations URSSAF - CSG/RDS déducti... | 153.31      |              | 153.31      |             |\r\n+--------------+---------------------------------------------------+-------------+--------------+-------------+-------------+\r\n| 6411-URSF3   | Charges - cotisations URSSAF - CSG/RDS non-dédu...| 86.89       |              | 86.89       |             |\r\n+--------------+---------------------------------------------------+-------------+--------------+-------------+-------------+\r\n| 706          | Produits - prestations de services                |             | 40000.00     |             | 40000.00    |\r\n+--------------+---------------------------------------------------+-------------+--------------+-------------+-------------+\r\n| 758          | Produits divers de gestion courante               |             | 0.34         |             | 0.34        |\r\n+--------------+---------------------------------------------------+-------------+--------------+-------------+-------------+\r\n|              | **Totaux**                                        | **89598.10**| **89598.10** | **48255.79**| **48255.79**|\r\n+--------------+---------------------------------------------------+-------------+--------------+-------------+-------------+\r\n```\r\n\r\n### Le Bilan\r\n\r\nThis document is a *résumé* or a «picture» of your business. It is\r\ngenerated from the *Balance des comptes*:\r\n\r\n``` {.sourceCode .bash}\r\n$ colbert_bilan.py ../balance-des-comptes/balance_des_comptes-2011.json \\\r\n    --label=\"MyBusiness - Bilan 2011 en €\" > bilan.json\r\n$ colbert_bilan_to_rst.py bilan.json > bilan.txt\r\n```\r\n\r\nA Makefile to automatically do all the work:\r\n\r\n``` {.sourceCode .make}\r\nFILENAME=\"bilan-2011\"\r\n\r\nall:    pdf\r\n\r\npdf:    tex\r\n    @pdflatex $(FILENAME).tex\r\n    @pdflatex $(FILENAME).tex\r\n    @pdflatex $(FILENAME).tex\r\n\r\ntex:    rst\r\n    @rst2latex.py --table-style=booktabs --output-encoding=utf-8 $(FILENAME).txt >  $(FILENAME).tex.tmp\r\n    @sed -E -f fix_table.sed < $(FILENAME).tex.tmp > $(FILENAME).tex\r\n\r\nrst:    json\r\n    @echo \"Conversion du bilan au format reStructuredText...\"\r\n    @colbert_bilan_to_rst.py $(FILENAME).json > $(FILENAME).txt\r\n\r\njson:\r\n    @echo \"calcul de la bilan...\"\r\n    @colbert_bilan.py ../balance-des-comptes/balance_des_comptes-2011.json \\\r\n        --label=\"MyBusiness - Bilan 2011 en €\"  > $(FILENAME).json\r\n\r\npurge:  clean\r\n    @for ext in \".pdf\" \".tex\" \".txt\"; do\\\r\n        [ -e $(FILENAME)$${ext} ] && rm $(FILENAME)$${ext} || [ 1 ] ;\\\r\n    done\r\n\r\nclean:\r\n    @for ext in \".out\" \".aux\" \".log\" \".tex.tmp\"; do\\\r\n        [ -e $(FILENAME)$${ext} ] && rm $(FILENAME)$${ext} || [ 1 ] ;\\\r\n    done\r\n```\r\n\r\nAnd the Sed script:\r\n\r\n    s/\\\\setlength{\\\\DUtablewidth}{\\\\linewidth}/\\\\setlength{\\\\tabcolsep}{25pt} \\\\setlength{\\\\extrarowheight}{4.5pt}/\r\n    s/\\\\begin{longtable\\*}.*/\\\\begin{longtable*}[c]{lrrr|lr}/\r\n\r\nThe reStructuredText output:\r\n\r\n``` {.sourceCode .rst}\r\n=======================\r\nBilan 2011 - MyBusiness\r\n=======================\r\n\r\n\r\n-----------------------------------\r\nPériode du 01/04/2011 au 31/12/2011\r\n-----------------------------------\r\n\r\n\r\n+------------------------------+------------------+----------------+---------------+-----------------------+---------------+\r\n| Actif                        | Brut             | Amortissement  | Net           | Passif                | Montant       |\r\n+==============================+==================+================+===============+=======================+===============+\r\n| **Actif_circulant**          |                  |                |               | **Capitaux_propres**  |               |\r\n+------------------------------+------------------+----------------+---------------+-----------------------+---------------+\r\n| Client_et_comptes_rattaches  | 11960.00         |                | 11960.00      | Resultat              | 9922.65       |\r\n+------------------------------+------------------+----------------+---------------+-----------------------+---------------+\r\n| Autres_creances              | 4.21             |                | 4.21          | **Dettes**            |               |\r\n+------------------------------+------------------+----------------+---------------+-----------------------+---------------+\r\n|                              |                  |                |               | Autres_dettes         | 2041.56       |\r\n+------------------------------+------------------+----------------+---------------+-----------------------+---------------+\r\n| *Total*                      | *11964.21*       | *0.00*         | **11964.21**  | *Total*               | **11964.21**  |\r\n+------------------------------+------------------+----------------+---------------+-----------------------+---------------+\r\n```\r\n\r\n### Le compte de résultat\r\n\r\nThe purpose of this last document is to give an idea of your activity\r\nduring the fiscal year:\r\n\r\n``` {.sourceCode .bash}\r\n$ colbert_compte_de_resultat.py ../balance-des-comptes/balance_des_comptes-2011.json \\\r\n    --label=\"MyBusiness - Compte de résultat 2011 en €\"  > compte-de-resultat.json\r\n$ colbert_compte_de_resultat_to_rst.py compte-de-resultat.json > compte-de-resultat.txt\r\n```\r\n\r\nIn a Makefile:\r\n\r\n``` {.sourceCode .make}\r\nFILENAME=\"compte_de_resultat-2011\"\r\n\r\nall:    pdf\r\n\r\npdf:    tex\r\n    @pdflatex $(FILENAME).tex\r\n    @pdflatex $(FILENAME).tex\r\n    @pdflatex $(FILENAME).tex\r\n\r\ntex:    rst\r\n    @rst2latex.py --table-style=booktabs --output-encoding=utf-8 $(FILENAME).txt > $(FILENAME).tex.tmp\r\n    @sed -E -f fix_table.sed < $(FILENAME).tex.tmp > $(FILENAME).tex\r\n\r\nrst:    json\r\n    @echo \"Conversion du compte de résultat au format reStructuredText...\"\r\n    @colbert_compte_de_resultat_to_rst.py $(FILENAME).json > $(FILENAME).txt\r\n\r\njson:\r\n    @echo \"calcul du compte de résultat...\"\r\n    @colbert_compte_de_resultat.py ../balance-des-comptes/balance_des_comptes-2011.json \\\r\n        --label=\"MyBusiness - Compte de résultat 2011 en €\"  > $(FILENAME).json\r\n\r\npurge:  clean\r\n    @for ext in \".pdf\" \".tex\" \".txt\"; do\\\r\n        [ -e $(FILENAME)$${ext} ] && rm $(FILENAME)$${ext} || [ 1 ] ;\\\r\n    done\r\n\r\nclean:\r\n    @for ext in \".out\" \".aux\" \".log\" \".tex.tmp\"; do\\\r\n        [ -e $(FILENAME)$${ext} ] && rm $(FILENAME)$${ext} || [ 1 ] ;\\\r\n    done\r\n```\r\n\r\nThe Sed script:\r\n\r\n    s/\\\\begin{longtable\\*}.*/\\\\newcolumntype{x}[1]{% \\\r\n    >{\\\\raggedleft\\\\hspace{0pt}}p{#1}}% \\\r\n    \\\\newcolumntype{y}[1]{% \\\r\n    >{\\\\raggedright\\\\hspace{0pt}}p{#1}}% \\\r\n    \\\\begin{longtable*}[c]{y{8.5cm}x{2.2cm}|y{8.5cm}x{2.2cm}}/\r\n    s/} \\\\\\\\/} \\\\tabularnewline/\r\n    s/&[[:space:]]+\\\\\\\\/\\& \\\\tabularnewline/\r\n    s/[[:space:]]+\\\\\\\\$/\\\\tabularnewline/\r\n\r\nThe reStructuredText output:\r\n\r\n``` {.sourceCode .rst}\r\n====================================\r\nCompte de résultat 2011 - MyBusiness\r\n====================================\r\n\r\n\r\n-----------------------------------\r\nPériode du 01/03/2011 au 31/12/2011\r\n-----------------------------------\r\n\r\n\r\n+---------------------------------+-----------+--------------------------------------------------+------------------+\r\n| Charges                         | Montant   | Produits                                         | Montant          |\r\n+=================================+===========+==================================================+==================+\r\n| *Charges d'exploitation*        |           | *Produits d'exploitation*                        |                  |\r\n+---------------------------------+-----------+--------------------------------------------------+------------------+\r\n| Rémunérations du personnel      | 3795.00   | Prestations de services                          | 40000.00         |\r\n+---------------------------------+-----------+--------------------------------------------------+------------------+\r\n| Fournitures non stockables      | 21.44     | Autres produits de gestion courante              | 0.34             |\r\n+---------------------------------+-----------+--------------------------------------------------+------------------+\r\n|                                 |           |                                                  |                  |\r\n+---------------------------------+-----------+--------------------------------------------------+------------------+\r\n| Autres services extérieurs      | 232.00    |                                                  |                  |\r\n+---------------------------------+-----------+--------------------------------------------------+------------------+\r\n|                                 |           |                                                  |                  |\r\n+---------------------------------+-----------+--------------------------------------------------+------------------+\r\n|                                 |           |                                                  |                  |\r\n+---------------------------------+-----------+--------------------------------------------------+------------------+\r\n|                                 |           |                                                  |                  |\r\n+---------------------------------+-----------+--------------------------------------------------+------------------+\r\n| *Charges financières*           |           | *Produits financiers*                            |                  |\r\n+---------------------------------+-----------+--------------------------------------------------+------------------+\r\n|                                 |           |                                                  |                  |\r\n+---------------------------------+-----------+--------------------------------------------------+------------------+\r\n|                                 |           |                                                  |                  |\r\n+---------------------------------+-----------+--------------------------------------------------+------------------+\r\n| *Charges exceptionnelles*       |           | *Produits exceptionnels*                         |                  |\r\n+---------------------------------+-----------+--------------------------------------------------+------------------+\r\n|                                 |           |                                                  |                  |\r\n+---------------------------------+-----------+--------------------------------------------------+------------------+\r\n|                                 |           |                                                  |                  |\r\n+---------------------------------+-----------+--------------------------------------------------+------------------+\r\n| **Sous-total charges**          | 4048.44   | **Sous-total produits**                          | 40000.34         |\r\n+---------------------------------+-----------+--------------------------------------------------+------------------+\r\n| **Résultat (bénéfice)**         | 35951.90  |                                                  |                  |\r\n+---------------------------------+-----------+--------------------------------------------------+------------------+\r\n```\r\n\r\nManaging the transition between 2 fiscal years\r\n----------------------------------------------\r\n\r\nWhen you have closed your fiscal year (say 2011) you have to create a\r\nnew one (2012). In Colbert, you create a new directory, *2012*, aside\r\n*2011*. You can simply make a *cp 2011 2012*, then run the *make purge*\r\nrules in each subdirectories and replace the dates and the filenames at\r\nthe top of each Makefile.\r\n\r\nThis may looks a bit awkward but this occurs only once a year!\r\n\r\n### Les écritures de clôture\r\n\r\nWhen a fiscal year is closed and when your documents and books are\r\nup-to-date (*Grand-livre*, *Balance des comptes*, *Bilan* and *Compte de\r\nrésultat*) you have to insert in the Livre-journal the *écritures de\r\nclôture* (accounts closing entries). The purpose of these entries is:\r\n\r\n1.  to reset the *comptes de résultat* (in France, it is those having a\r\n    number in *6xx* and *7xx*) ;\r\n2.  transfert the gain or the lost registred at the end of the fiscal\r\n    year on the *comptes de bilan*.\r\n\r\nColbert comes with a script to compute such entries:\r\n\r\n``` {.sourceCode .bash}\r\n$ colbert_ecritures_de_cloture.py ../balance-des-comptes/balance_des_comptes-2011.json > ecritures-de-cloture.json\r\n$ colbert_ecritures_to_livre_journal.py --label=\"Ecriture de cloture a reporter au Livre-journal\" \\\r\n    ecritures-de-cloture.json > ecritures-de-cloture.txt\r\n```\r\n\r\nAnd copy/paste the body of *ecritures-de-cloture.txt* into the\r\nLivre-journal at the right place.\r\n\r\nChecking your account statements against the Livre-journal\r\n----------------------------------------------------------\r\n\r\nThere must be reciprocity between your account statements from your bank\r\nand the entries in your Livre-journal.\r\n\r\nColbert is able to generate account statements for a bank account (say\r\n*512*) and to check the balance against a JSON file representing the\r\nbalances of each account statement received from the bank establishment.\r\nWrite such a file with your text editor:\r\n\r\n``` {.sourceCode .json}\r\n[\r\n    {\r\n        'numero_compte': \"512\",\r\n        'journaux': [\r\n            {\r\n                'label': \"Avril 2011\",\r\n                'date_debut': \"01/04/2011\",\r\n                'date_fin': \"02/05/2011\",\r\n                'debit_initial': \"0.00\",\r\n                'credit_initial': \"0.00\",\r\n                'debit_final': \"1485.93\",\r\n                'credit_final': \"0.00\",\r\n            },\r\n            {\r\n                'label': \"Mai 2011\",\r\n                'date_debut': \"03/05/2011\",\r\n                'date_fin': \"01/06/2011\",\r\n                'debit_initial': \"1485.93\",\r\n                'credit_initial': \"0.00\",\r\n                'debit_final': \"1461.94\",\r\n                'credit_final': \"0.00\",\r\n            },\r\n        ]\r\n    }\r\n]\r\n```\r\n\r\nAnd run *colbert\\_solde\\_de\\_compte.py\r\n../../../livre-journal/livre-journal.txt solde.json* which outputs:\r\n\r\n``` {.sourceCode .rst}\r\n=====================\r\nCompte n°512 en Euros\r\n=====================\r\n\r\n\r\nAvril 2011\r\n''''''''''\r\n+------------+-------------------------------------------------------+--------+------------+---------------+----------------+\r\n| Date       | Libellé                                               | Débit  | Crédit     | Solde débiteur| Solde créditeur|\r\n+============+=======================================================+========+============+===============+================+\r\n| 01/04/2011 | Report à nouveau                                      |        |            |               |                |\r\n+------------+-------------------------------------------------------+--------+------------+---------------+----------------+\r\n| 01/04/2011 | Résultat arrêté compte                                |        | 48.00      |               | 48.00          |\r\n+------------+-------------------------------------------------------+--------+------------+---------------+----------------+\r\n| 02/04/2011 | Capital initial Dépôt de 1500 € par Stanislas Guerra a| 1500.00|            | 1452.00       |                |\r\n+------------+-------------------------------------------------------+--------+------------+---------------+----------------+\r\n| 28/04/2011 | Cotisation Option PRO  LCL                            |        | 15.00      | 1437.00       |                |\r\n+------------+-------------------------------------------------------+--------+------------+---------------+----------------+\r\n| 02/05/2011 | Abonnement LCL Access                                 |        | 3.00       | 1434.00       |                |\r\n+------------+-------------------------------------------------------+--------+------------+---------------+----------------+\r\n+---------------------------------------------------------------------------------------------------------------------------+\r\n| Solde final calculé (*1434.00*, débiteur) *différent* du solde final attendu (*1485.93*, débiteur)                        |\r\n+---------------------------------------------------------------------------------------------------------------------------+\r\n\r\n.. raw:: latex\r\n\r\n    \\newpage\r\n\r\nMai 2011\r\n''''''''\r\n+------------+-------------------------------------------------------+------+------------+----------------+-----------------+\r\n| Date       | Libellé                                               | Débit| Crédit     | Solde débiteur | Solde créditeur |\r\n+============+=======================================================+======+============+================+=================+\r\n| 03/05/2011 | Report à nouveau                                      |      |            | 1485.93        |                 |\r\n+============+=======================================================+======+============+================+=================+\r\n+---------------------------------------------------------------------------------------------------------------------------+\r\n| Solde final calculé (*1485.93*, débiteur) *différent* du solde final attendu (*1461.94*, débiteur)                        |\r\n+---------------------------------------------------------------------------------------------------------------------------+\r\n\r\n.. raw:: latex\r\n\r\n    \\newpage\r\n```\r\n\r\nMaking invoices\r\n---------------\r\n\r\nColbert can assist you to compute invoices, generate TeX/PDF outputs and\r\nthe Livre-journal entries from them. You start with a JSON file like the\r\none below and use the script *colbert\\_calculer\\_facture.py* to fill it\r\nout:\r\n\r\n``` {.sourceCode .json}\r\n{\r\n    \"client\": {\r\n        \"nom\": \"MyClient#1\",\r\n            \"adresse\": \"1, Infinite Loop\",\r\n            \"code_postal\": \"11222\",\r\n            \"ville\": \"Cupertino\",\r\n            \"numero_compte\": \"4111-CL1\",\r\n            \"nom_compte\": \"Clients - ventes de biens ou prestations de services\",\r\n            \"reference_commande\": \"XXXXX\"\r\n    },\r\n    \"numero_facture\": \"YYYYYYY\",\r\n    \"date_facture\": \"10/05/2011\",\r\n    \"nb_jours_payable_fin_de_mois\": \"60\",\r\n    \"taux_penalites\": \"11\",\r\n    \"date_debut_execution\": \"10/04/2011\",\r\n    \"date_fin_execution\": \"30/04/2011\",\r\n    \"devise\": \"Euro\",\r\n    \"symbole_devise\": \"€\",\r\n    \"nom_compte\": \"Produits - prestations de services\", \r\n    \"numero_compte\": \"706\", \r\n    \"detail\": [\r\n        {\r\n            \"reference\": \"ref-A\",\r\n            \"description\": \"Prestation A.\",\r\n            \"prix_unitaire_ht\": \"100.00\",\r\n            \"unite\": \"jours\",\r\n            \"taux_tva\": \"19.6\",\r\n            \"quantite\": \"4\"\r\n        },\r\n        {\r\n            \"reference\": \"ref-B\",\r\n            \"description\": \"Prestation B.\",\r\n            \"prix_unitaire_ht\": \"450.99\",\r\n            \"unite\": \"jours\",\r\n            \"taux_tva\": \"19.6\",\r\n            \"quantite\": \"11\"\r\n        }\r\n    ],\r\n    \"deja_paye\": \"0.00\"\r\n}\r\n```\r\n\r\n``` {.sourceCode .bash}\r\n$ colbert_calculer_facture.py my_invoice.json\r\n```\r\n\r\nProduce the following:\r\n\r\n``` {.sourceCode .json}\r\n{\r\n    \"date_facture\": \"10/05/2011\", \r\n    \"symbole_devise\": \"\\u20ac\", \r\n    \"deja_paye\": \"0.00\", \r\n    \"taux_penalites\": \"11\", \r\n    \"montant_ht\": \"5360.89\", \r\n    \"date_fin_execution\": \"30/04/2011\", \r\n    \"detail\": [\r\n        {\r\n            \"quantite\": \"4\", \r\n            \"description\": \"Prestation A.\", \r\n            \"reference\": \"ref-A\", \r\n            \"montant_ht\": \"400.00\", \r\n            \"prix_unitaire_ht\": \"100.00\", \r\n            \"unite\": \"jours\", \r\n            \"taux_tva\": \"19.6\"\r\n        }, \r\n        {\r\n            \"quantite\": \"11\", \r\n            \"description\": \"Prestation B.\", \r\n            \"reference\": \"ref-B\", \r\n            \"montant_ht\": \"4960.89\", \r\n            \"prix_unitaire_ht\": \"450.99\", \r\n            \"unite\": \"jours\", \r\n            \"taux_tva\": \"19.6\"\r\n        }\r\n    ], \r\n    \"numero_facture\": \"YYYYYYY\", \r\n    \"devise\": \"Euro\", \r\n    \"nom_compte\": \"Produits - prestations de services\", \r\n    \"numero_compte\": \"706\", \r\n    \"client\": {\r\n        \"ville\": \"Cupertino\", \r\n        \"code_postal\": \"11222\", \r\n        \"nom\": \"MyClient#1\", \r\n        \"adresse\": \"1, Infinite Loop\", \r\n        \"reference_commande\": \"XXXXX\", \r\n        \"nom_compte\": \"Clients - ventes de biens ou prestations de services\",\r\n        \"numero_compte\": \"4111-CL1\"\r\n    }, \r\n    \"montant_ttc\": \"6411.62\", \r\n    \"date_debut_execution\": \"10/04/2011\", \r\n    \"reste_a_payer\": \"6411.62\", \r\n    \"nb_jours_payable_fin_de_mois\": \"60\", \r\n    \"date_debut_penalites\": \"01/08/2011\", \r\n    \"tva\": {\r\n        \"19.6\": \"1050.73\"\r\n    }, \r\n    \"date_reglement\": \"31/07/2011\"\r\n}\r\n```\r\n\r\nYou should redirect the output to a new file, say *my\\_invoice\\_ok.json*\r\nand use it to generate a LaTeX output:\r\n\r\n``` {.sourceCode .bash}\r\n$ colbert_facture_to_tex.py my_invoice_ok.json my_invoice_template.tex > my_invoice.tex\r\n$ xelatex my_invoice.tex\r\n```\r\n\r\nThe parameter *my\\_invoice\\_template.tex* is a TeX file having\r\nplaceholder for Python string formatting with keyword arguments. There\r\nis an example of such template in the *tests/regressiontests/* folder.\r\n\r\n### Livre-journal entry\r\n\r\nHaving an invoice filled-in you can now generate the entry for the\r\nLivre-journal:\r\n\r\n``` {.sourceCode .bash}\r\n$ colbert_ecriture_facture.py my_invoice_ok.json > my_invoice_entry.json\r\n$ colbert_ecritures_to_livre_journal.py --label=\"Entry to report\" my_invoice_entry.json > my_invoice_entry.txt\r\n```\r\n\r\n### Workflow\r\n\r\nMy method is to use a directory for each invoice with the following\r\nMakefile in it:\r\n\r\n``` {.sourceCode .make}\r\nfilename = facture-2012-003\r\nfilename_calcule = $(filename)_calculee\r\nfilename_ecriture = $(filename)_ecriture\r\n\r\npdf:    tex\r\n    @xelatex --papersize=a4 $(filename).tex\r\n    @xelatex --papersize=a4 $(filename).tex\r\n    @xelatex --papersize=a4 $(filename).tex\r\n\r\ntex:    json\r\n    @export LC_ALL=\"fr_FR.UTF-8\" ; export LC_LANG=\"fr_FR.UTF-8\" ; \\\r\n    colbert_facture_to_tex.py $(filename_calcule).json ../../modele_facture.tex > $(filename).tex\r\n\r\njson:\r\n    @colbert_calculer_facture.py $(filename).json > $(filename_calcule).json\r\n    @colbert_ecriture_facture.py $(filename_calcule).json > $(filename_ecriture).json\r\n    @colbert_ecritures_to_livre_journal.py --label=\"Ecriture a reporter au Livre-journal\" \\\r\n        $(filename_ecriture).json > $(filename_ecriture).txt\r\n\r\nclean:\r\n    @for ext in \".out\" \".aux\" \".log\" \".tns\"; do\\\r\n        [ -e $(filename)$${ext} ] && rm $(filename)$${ext} || [ 1 ] ;\\\r\n    done\r\n```\r\n\r\n### Activity report from iCal\r\n\r\nThere is a template of LaTeX class in the *tex* directory. Again, I use\r\na Makefile (the same to generate the invoice associated with):\r\n\r\n``` {.sourceCode .make}\r\nmonth = Juin\r\nmonth_index = 007\r\nyear = 2012\r\ndate_debut = 01/06/2012 \r\ndate_fin = 30/06/2012 \r\n\r\nref_facture = $(year)-$(month_index)\r\n\r\nfilename = facture-$(ref_facture)\r\nfilename_calcule = $(filename)_calculee\r\nfilename_ecriture = $(filename)_ecriture\r\n\r\nrac_template = \"rapport_activite-template.tex\"\r\nrac_filename = rac-$(ref_facture)\r\nrac_label = \"Rapport d'activité - $(month) $(year)\"\r\ncalendar = MyCalendar.ics\r\n\r\nall:    rac_pdf facture_pdf\r\n\r\nfacture_pdf:    facture_tex\r\n    @xelatex --papersize=a4 $(filename).tex\r\n    @xelatex --papersize=a4 $(filename).tex\r\n    @xelatex --papersize=a4 $(filename).tex\r\n\r\nfacture_tex:    facture_json\r\n    @export LC_ALL=\"fr_FR.UTF-8\" ; export LC_LANG=\"fr_FR.UTF-8\" ; \\\r\n        colbert_facture_to_tex.py $(filename_calcule).json ../../modele_facture.tex > $(filename).tex\r\n\r\nfacture_json:\r\n    @colbert_calculer_facture.py $(filename).json > $(filename_calcule).json\r\n    @colbert_ecriture_facture.py $(filename_calcule).json > $(filename_ecriture).json\r\n    @colbert_ecritures_to_livre_journal.py --label=\"Ecriture a reporter au Livre-journal\" \\\r\n        $(filename_ecriture).json > $(filename_ecriture).txt\r\n\r\nrac_pdf:    rac_tex\r\n    @xelatex --papersize=a4 $(rac_filename).tex\r\n    @xelatex --papersize=a4 $(rac_filename).tex\r\n    @xelatex --papersize=a4 $(rac_filename).tex\r\n\r\nrac_tex:    rac_json\r\n    @colbert_rapport_activite_to_tex.py $(rac_filename).json $(rac_template) > $(rac_filename).tex\r\n\r\nrac_json:\r\n    @colbert_rapport_activite.py $(calendar) -d $(date_debut) -f $(date_fin) \\\r\n        -l $(rac_label) -r \"$(ref_facture)\" > $(rac_filename).json\r\n\r\npurge:  clean\r\n    @for ext in \".tex\" \".pdf\" ; do\\\r\n        [ -e $(filename)$${ext} ] && rm $(filename)$${ext} || [ 1 ] ;\\\r\n        [ -e $(rac_filename)$${ext} ] && rm $(rac_filename)$${ext} || [ 1 ] ;\\\r\n    done\r\n\r\nclean:\r\n    @for ext in \".out\" \".aux\" \".log\" \".tns\"; do\\\r\n        [ -e $(filename)$${ext} ] && rm $(filename)$${ext} || [ 1 ] ;\\\r\n        [ -e $(rac_filename)$${ext} ] && rm $(rac_filename)$${ext} || [ 1 ] ;\\\r\n    done\r\n```\r\n\r\nYou should take a look in the *tests/regressiontests* directory to grab\r\nthe LaTeX template.\r\n\r\nWorking with LaTeX\r\n------------------\r\n\r\nI convert my reStructuredText files using docutils' *rst2latex.py* with\r\nthe *--table-style=booktabs* option except for the Livre-journal.\r\n\r\nAside each Makefile in each directory (like *TVA* or *grand-livre*)\r\nthere is a docutils configuration file *docutils.conf* and a LaTeX\r\nstylesheet *docutils.tex*.\r\n\r\nBecause I want to right-align some columns and because docutils does not\r\nhandle that, I process the LaTeX outputs with a bit of *Sed* before the\r\nPDF conversion.\r\n\r\n### The docutils.conf file\r\n\r\nAlways the same:\r\n\r\n    [latex2e writer]\r\n    documentclass: article\r\n    documentoptions: 11pt,a4paper,landscape\r\n    output-encoding: utf-8\r\n    stylesheet: docutils.tex\r\n\r\n### The docutils.tex stylesheet\r\n\r\nAlmost always:\r\n\r\n    \\usepackage{fullpage}\r\n    \\usepackage[french]{babel}\r\n    \\usepackage{array}\r\n\r\nIf the LaTeX compiler complains about utf-8 you may add the *ucs*\r\npackage.\r\n\r\nYou may want to precisely control the header and the footer with\r\n*fancyhdr* package:\r\n\r\n    \\usepackage{fancyhdr}\r\n    \\fancyhf{}\r\n    \\pagestyle{fancy}\r\n    \\lhead{\\large{MyBusiness S.A.R.L.}\\\\\r\n    \\normalsize my address\\\\\r\n    zipcode City}\r\n    \\cfoot{Société à responsabilité limité au capital de XXXX Euros - YYY YYY YYY R.C.S. Paris}\r\n    \\renewcommand{\\headrulewidth}{0pt}\r\n    \\renewcommand{\\footrulewidth}{0.4pt}\r\n\r\n### The Sed script\r\n\r\nThe idea is to change the table(s) declaration(s) to get columns with\r\nmanaged width and alignment.\r\n\r\nIn the Makefile it looks like that:\r\n\r\n``` {.sourceCode .make}\r\ntex:    rst\r\n    @rst2latex.py --table-style=booktabs $(FILENAME).txt >  $(FILENAME).tex.tmp\r\n    @sed -E -f fix_table.sed < $(FILENAME).tex.tmp > $(FILENAME).tex\r\n```\r\n\r\nThe Sed script depends of the TeX file. Here an example:\r\n\r\n    s/\\\\begin{longtable\\*}.*/\\\\newcolumntype{x}[1]{% \\\r\n    >{\\\\raggedleft\\\\hspace{0pt}}p{#1}}% \\\r\n    \\\\newcolumntype{y}[1]{% \\\r\n    >{\\\\raggedright\\\\hspace{0pt}}p{#1}}% \\\r\n    \\\\begin{longtable*}[c]{y{2cm}y{7.5cm}x{2cm}|y{2cm}y{7.5cm}x{2cm}}/\r\n    s/\\\\\\\\/\\\\tabularnewline/\r\n\r\nAnd to force the *pagestyle* for the first one I sometimes add:\r\n\r\n    s/\\\\maketitle/\\\\maketitle\\\r\n    \\\\thispagestyle{fancy}/\r\n\r\nInstallation\r\n------------\r\n\r\n``` {.sourceCode .bash}\r\npip install Colbert\r\n```\r\n\r\nTests\r\n-----\r\n\r\nThere are some regression tests in the *test* directory.\r\n\r\nRequirements\r\n------------\r\n\r\n-   Python 2.6+ ;\r\n-   pytz ;\r\n-   Python Icalendar (<https://github.com/collective/icalendar>) ;\r\n-   Docutils (SVN) ;\r\n-   a *LaTex* suite if you want to render the reStructuredText in PDF ;\r\n-   Make ;\r\n-   Sed.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}